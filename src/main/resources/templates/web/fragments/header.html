<!DOCTYPE html>
<html lang="" xmlns:th="http://www.thymeleaf.org"
xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5">
<head>
<title></title>
<meta charset="utf-8">
</head>
<body>

	<th:block th:fragment= "header">
	
		<div class="backdrop"></div>
		<a class="backtop fas fa-arrow-up" href="#"></a>
		<div class="header-top">
			<div class="container">
				<div class="row">
					<div class="col-md-12 col-lg-5">
						<div class="header-top-welcome">
							<p>Chào mừng bạn đến với nhà sách Đại Việt !</p>
						</div>
					</div>
 					<div class="col-md-5 col-lg-3">
						<div class="header-top-select">
							<div class="header-select">
								<i class="icofont-world"></i>
								<span style="color: white;">Việt Nam</span>
							</div>
							<div class="header-select">
								<i class="icofont-money"></i>
								<span style="color: white;">Vnđ</span>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<header class="header-part">
			<div class="container">
				<div class="header-content">
					<div class="header-media-group">
						<button class="header-user">
							<img src="/images/user.png" alt="user" />
						</button>
						<a th:href="@{/}"> <img src="/images/logo-01.png" alt="logo" />
						</a>
						<button class="header-src">
							<i class="fas fa-search"></i>
						</button>
					</div>
					
					<a th:href="@{/}" class="header-logo">
					<img src="/images/logo-01.png" alt="logo" />
					</a>
				
					<th:block th:if="${#request.remoteUser}">
						<a href="javascript:void(0);" class="header-widget" title="Tên của bạn">
							<img src="/images/user.png" alt="user" />
							<span>Hi!<strong><em>  [[${user.name}]]</em></strong></span>
						</a>
					</th:block>
					
					<form th:action="@{/searchProduct}" class="header-form">
						<input type="text" name="keyword" th:value="${keyword}" placeholder="Tìm kiếm..." autocomplete="off" />
						<button>
							<i class="fas fa-search"></i>
						</button>
					</form>
					
					<div class="header-widget-group">
						<th:block th:if="${#request.remoteUser}">
						<a th:href="@{/profile}" class="header-widget" title="Trang cá nhân">
							<i class="fas fa-user"></i>
						</a>
						</th:block>
						<a th:href="@{/favorite}" class="header-widget" title="Yêu thích">
							<i class="fas fa-heart"></i><sup th:text="${totalSave}" id="totalSave">0</sup>
						</a>
						<button class="header-widget header-cart" title="Giỏ hàng">
						<div sec:authorize="!isAuthenticated()">
							<i class="fas fa-shopping-basket"></i> <sup id="totalCartItems">0</sup>
						</div>
						<div sec:authorize="isAuthenticated()">
							<i class="fas fa-shopping-basket"></i> <sup th:text="${totalCartItems}" id="totalCartItems">0</sup>
						</div>
						</button>
					</div>
				</div>
			</div>
		</header>
		<nav class="navbar-part">
			<div class="container">
				<div class="row">
					<div class="col-lg-12">
						<div class="navbar-content">
							<ul class="navbar-list">
								<li class="navbar-item dropdown"><a
									class="navbar-link" href="/">Trang chủ</a></li>
								<li class="navbar-item dropdown">
									<a class="navbar-link" th:href="@{/aboutUs}">Giới thiệu</a>
								</li>
								<li class="navbar-item">
									<a class="navbar-link" th:href="@{/products}">Sản phẩm</a>
								</li>
								<li class="navbar-item dropdown">
									<a class="navbar-link dropdown-arrow" href="javascript:void(0);">Thể loại</a>
									<ul class="dropdown-position-list">
										<li th:each="item : ${categoryList}">
											<a th:href="@{/productByCategory(id=${item.categoryId})}">[[${item.categoryName}]]</a>
										</li>
									</ul>
								</li>
								<li class="navbar-item dropdown">
									<a class="navbar-link" th:href="@{/contact}">Liên hệ</a>
								</li>
								<li class="navbar-item dropdown"><a
									class="navbar-link dropdown-arrow" href="javascript:void(0);">Tài khoản</a>
									<ul class="dropdown-position-list">
										<th:block th:unless="${#request.remoteUser}">
							              	<li><a th:href="@{/login}">Đăng nhập</a></li>
											<li><a th:href="@{/register}">Đăng ký</a></li>
											<li><a th:href="@{/forgotPassword}">Quên mật khẩu</a></li>
							            </th:block>
							            <th:block th:if="${#request.remoteUser}">
											<li><a th:href="@{/profile}">Thông tin tài khoản</a></li>
											<li><a th:href="@{/logout}">Đăng xuất</a></li>
						              	</th:block>
										
									</ul>
								</li>
							</ul>
							<div class="navbar-info-group">
								<div class="navbar-info">
									<i class="icofont-ui-touch-phone"></i>
									<p>
										<small>Số điện thoại</small><span>(+84) 024 6669 9999</span>
									</p>
								</div>
								<div class="navbar-info">
									<i class="icofont-ui-email"></i>
									<p>
										<small>email</small><span>dvbookstore@gmail.com</span>
									</p>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</nav>
	
		<!-- slide giỏ hàng -->
		<aside class="cart-sidebar">
			<div class="cart-header">
				<div class="cart-total">
					<div sec:authorize="!isAuthenticated()">
						<i class="fas fa-shopping-basket"></i><span>Tổng số sản phẩm (0)</span>
<!-- 						<h4 style="color: #119744" class="mt-5">Hiện tại bạn chưa có sản phẩm nào trong giỏ hàng!</h4>
						<h5 style="color: #119744">Hãy mua sắm đi nào!</h5>
						<a th:href="@{/products}" style="text-decoration: underline;">Click tại đây!</a> -->
					</div>
					<div sec:authorize="isAuthenticated()">
						<i class="fas fa-shopping-basket"></i><span>Tổng số sản phẩm ([[${totalCartItems}]])</span>
					</div>
				</div>
				<button class="cart-close">
					<i class="icofont-close"></i>
				</button>
				
			</div>
			
			<div th:unless="${totalCartItems!=0}" class="text-center">
				<h4 style="color: #119744" class="mt-5">Hiện tại bạn chưa có sản phẩm nào trong giỏ hàng!</h4>
				<h5 style="color: #119744">Hãy mua sắm đi nào!</h5>
				<a th:href="@{/products}" style="text-decoration: underline;">Click tại đây!</a>
			</div>
			
			<th:block th:if="${totalCartItems!=0}">
 			<form action="/checkout" method=get id="target">
				<ul class="cart-list">
				<div sec:authorize="isAuthenticated()">
					<li class="cart-item" th:each="item,iter : ${cartItems}">
					<div class="cart-media">
						<th:block th:if="${item.product.productImage == ''}">
							<img src="../images/product/booknotfount.png" width=100 alt="product" />
						</th:block>
						<th:block th:if="${item.product.productImage != ''}">
							<a class="product-image" href="javascript:void(0);">
	                           <img th:src="@{'/loadImage?imageName='+${item.product.productImage}}" width=100 alt="product" />
	                        </a>
						</th:block>
					</div>
					<div class="cart-info-group">
						<div class="cart-info">
							<h6>
								<label>Tên sản phẩm :</label>
								<a th:href="@{/productDetail(id=${item.product.productId})}" style="color: #119744">[[${item.product.productName}]]</a>
							</h6>
							<label>Đơn giá :</label>
							<p>[[${#numbers.formatDecimal(item.product.price - (item.product.price * item.product.discount/100), 1, 'DEFAULT', 0, 'DEFAULT')}+'.000đ']]</p>
						</div>
						<div class="cart-action-group">
							<div class="product-action">
								<label>Số lượng :</label>
								<input class="action-input" title="Quantity Number" type="number"
									name="quantity" th:value="${item.quantity}" min="1"/>
							</div>
							<h6>[[${#numbers.formatDecimal((item.product.price - (item.product.price * item.product.discount/100)) * item.quantity, 1, 'DEFAULT', 0, 'DEFAULT')}+ '.000đ']]</h6>
						</div>
					</div>
                    <a class="trash" th:href="@{'/remove/'+${item.product.productId}}" title="Xóa sản phẩm" >
                    	<i class="icofont-trash"></i>
                    </a>
				</li>
				</div>
			</ul>
			<div class="cart-footer">
 				<span style="display: block; color: var(--white); background-color: var(--primary); height: 36px; border-radius: 4px; cursor: pointer;"
 				 th:onclick="checkCart()"
					class="checkout-label">Đặt hàng</span>
				<script th:inline="javascript"> 
					function checkCart() {
						var cart = [[${cartItems}]];
						
						var check = true;
						
						document.getElementById('error-quantity').innerHTML = '';
						
						$('.action-input').each(function(index, element) {
						    var currentElement = $(this);
						    var value = currentElement.val();
						    
						    if(value>cart[index].product.quantity) {
						    	check = false;
						    	console.log(index);
						    	$('#overQuantityId').modal('show');
						    	document.getElementById('error-quantity').innerHTML += `<p>Sách: ${cart[index].product.productName} - SL Còn: ${cart[index].product.quantity}</p>`;
						    }
						});
						
						if(check) {
							$( "#target" ).submit();
						}
					}
				</script>
			</div>
 			</form>
			
			</th:block>
		</aside>
		
		<!-- Modal -->
		<div class="modal" id="overQuantityId">
			<div class="modal-dialog modal-dialog-centered">
				<div class="modal-content">
					<button class="modal-close" data-bs-dismiss="modal">
		            	<i class="icofont-close"></i>
		          	</button>
					<div class="modal-form">
						<h5 class="modal-title" style="color: red">Bạn đã đặt quá số lượng hiện có !</h5>
						<div class="modal-body">
						<p id="error-quantity">
							
						</p>
					</div>
					</div>
				</div>
			</div>
		</div>
	</th:block>
</body>
</html>